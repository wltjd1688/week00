<script>
    //-- sideBar--
    function sideBarShow(){
        $(".side-bar").show()
        //개인 프로필, 개인정보, 위시리스트 추가등등 만들기 -->
        //미리 만들어둔 html을 보여주고 안보여주고하는식으로 -->
    };

    function sideBarHide(){
        $(".side-bar").hide()
    };
    //--------

    //-- 로그아웃--
    function logOut(){
        if (confirm('진짜 로그아웃 하십니까?')){
            document.cookie = 'token' + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=[something];"
            window.localStorage.removeItem('username')
            window.localStorage.removeItem('userimg')
            location.href = '../login'
        }
        else {
            console.log("로그아웃안함")
        }
    };
    //----------

    //--token 확인 및 유저정보 받기
    $(document).ready(function(){
        try {
            const cookieValue = document.cookie
                .split('; ')
                .find(row => row.startsWith("token="))
                .split('=')[1];
            try {
                var name = localStorage.getItem('username');
                var img = localStorage.getItem('userimg');
                $('#var-name, #username').text(name);
                $('#var-img, #userimg').attr('src', img);
                //$('#var-img, #userimg').attr('src', "../"+img);
                $('#profile').show()
            }
            catch {
                $.ajax({
                    type: "GET",
                    url: "/nav",
                    success: function(response) {
                        localStorage.setItem('username',response.user_name);
                        localStorage.setItem('userimg',response.user_img);
                        console.log(response.user_img)
                        $('#var-name, #username').text(response.user_name);
                        //$('#var-img, #userimg').attr('src', "../"+response.user_img);
                        $('#var-img, #userimg').attr('src', response.user_img);
                    },
                    error: function(error) {
                        alert("Invalid credentials");
                    }
                });

                $('#profile').show()
                }
        }
        catch (error) {
            $('#profile').hide()
        }
    });
    //--알림 모달창 보여주기
    function alarmShow(){
        $("#alarm-list").show()
    };

    function alarmHide(){
        $("#alarm-list").hide()
    }
    //--친구 찾기창 보여주기
    function firendShow(){
        $("#firend-find").toggle();
    }
</script>

<!-- 사이드바 -->
<div class="side-bar justify-content-center text-center non-show">
    <div class="m-4" id="bar-profile">
        <div class="bar-close" id="close" onclick="sideBarHide()">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <a aria-hidden="true" style="font-size:30px">&times;</a>
            </button>
        </div>
        <img class="rounded-circle d-inline img-100x100" src="../static/img/default.png" id="var-img"/>
        <p class="px-2" id="var-name">가나다라마바사</p>
    </div>
    <hr>
    <div class="bar-content">
        <div id="edit-profile"><span href="/profile">개인정보수정</span></div>
        <div id="addlist"><span href="/item">위시리스트 만들기</span></div>
        <div id="alarm-follow"><span onclick="alarmShow()">알람</span>
            <!-- 알람 모달 -->
            <div class="modal non-show" style="color:black !important; background-color:rgba(0,0,0,0.8);" tabindex="-1" id="alarm-list" onclick="alarmHide()">
                <div class="modal-dialog" onclick="event.stopPropagation()">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">알람</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true" onclick="alarmHide()">&times;</span>
                            </button>                      
                        </div>
                        <div class="modal-body">
                            <!-- 요청옴 -->
                            <div class="mx-2 my-1 p-auto border rounded" id="alarm-request">
                                <div class="p-2 d-flex justify-content-end" id="alarm-confirm">
                                    <p class="m-auto text-center">요청받은사람 이 친구신청을 했습니다.</p>
                                    <div class="justifly-content-end">
                                        <span class="btn btn-success mr-1">수락</span>
                                        <span class="btn btn-danger">거절</span>
                                    </div>
                                </div>
                            </div>
                            <!-- 수락 -->
                            <div class="mx-2 my-1 p-auto border border-success rounded" id="alarm-requested">
                                <div class="p-2 d-flex justify-content-end" id="alarm-yes">
                                    <p class="m-auto pr-3">요청받은사람 이 친구신청을 받았습니다</p>
                                    <div class="d-flex justify-content-end">
                                        <span class="btn btn-primary ">확인</span>
                                    </div>
                                </div>
                            </div>
                            <!-- 거절 -->
                            <div class="mx-2 my-1 p-auto border border-danger rounded" id="alarm-request">
                                <div class="p-2 d-flex justify-content-end" id="alarm-no">
                                    <p class="m-auto pr-3">요청보낸사람 이 친구신청을 거절했습니다.</p>
                                    <div class="d-flex justify-content-end">
                                        <span class="btn btn-primary">확인</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--  -->
        </div>
        <div style="padding:0px" id="addlist"><span onclick="firendShow()">친구추가</span></div>
        <!-- 친구찾기 -->
            <div class="non-show bg-light w-100 pb-0 mt-2" id="firend-find">
                <div class="input-group p-2 ">
                    <input type="text" class="form-control" placeholder="친구 아이디" aria-label="Recipient's username" aria-describedby="button-addon2">
                    <div class="input-group-append">
                        <button class="btn btn-outline-secondary" type="button" id="button-addon2">찾기</button>
                    </div>
                </div>
            </div>
            <hr>
            <div class="bar-content" onclick="logOut()" id="logout"><span>로그아웃</span></div>
            <!--  -->
        </div>
    </div>
</div>
<!-- nav -->
<nav class="navbar navbar-light bg-light justify-content-between">
    <a href="/" class="navbar-brand mb-0 h1">위시리스트</a>
    <div class="non-block" onclick="sideBarShow()" id="profile">
        <img class="rounded-circle float-left img-24x24" src="../static/img/default.png" id="userimg">
        <div class="float-right px-2" id="username">profile</div>
    </div>
</nav>
